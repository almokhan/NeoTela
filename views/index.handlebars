<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #c7c7c7;
            margin: 0;
            padding: 10px;
            color: #333;
        }
        .dashboard {
            display: flex;
            gap: 0;
            flex-wrap: wrap;
        }
        .table-container {
            background-color: #504f4f;
            flex: 1;
            min-width: 300px;
            border: 3px solid black;
            overflow: hidden;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            border-spacing: 0;
            table-layout: fixed;
        }
        th, td {
            background-color: #504f4f;
            padding: 21px;
            text-align: center;
            color: black;
            border: none;
            vertical-align: middle;
        }
        th {
            background-color: #494949; 
            color: yellow;
        }
        .yellow-bg { background-color: #504f4f; color: rgb(250, 234, 9); }
        .red-bg { background-color: rgb(255, 32, 32); color: black;}
        .gray-bg { background-color: #504f4f; color: black; }
        .gray-apr { background-color: #504f4f; color: yellow; }
        .error-message {
            color: red;
            background-color: #ffe6e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }
        .destaque-cell {
            border: 1px solid yellow;
            color: yellow;
            font-weight: bold;
            width: 50%;
        }
        .imparhora-cell {
            background-color: #5f5f5f;
            color: black;
        }
    </style>
</head>
<body>
    <div id="errorMessage" class="error-message"></div>
    <h2><span id="systemName">{{labviewData.[0]}}</span></h2>

    <div class="dashboard">
        <div class="table-container">
            <table>
                <tr>
                    <th colspan="3">Periodo: <span id="periodoSpan">{{labviewData.[1]}}</span></th>
                </tr>
                <tr>
                    <td colspan="3" class="destaque-cell">Produto: <span id="produtoSpan">{{labviewData.[2]}}</span></td>
                </tr>
                <tr>
                    <td class="yellow-bg">Planejada</td>
                    <td class="red-bg"><span id="valor16">{{labviewData.[4]}}</span></td>
                    <td class="gray-bg"><span id="valor17">{{labviewData.[9]}}</span></td>
                </tr>
                <tr>
                    <td class="yellow-bg">Expectativa</td>
                    <td class="red-bg"><span id="valor18">{{labviewData.[5]}}</span></td>
                    <td class="gray-bg"><span id="valor19">{{labviewData.[10]}}</span></td>
                </tr>
                <tr>
                    <td class="yellow-bg">Produzidas</td>
                    <td class="red-bg"><span id="valor20">{{labviewData.[6]}}</span></td>
                    <td class="gray-bg"><span id="valor21">{{labviewData.[11]}}</span></td>
                </tr>
                <tr>
                    <td class="yellow-bg">Reprovadas</td>
                    <td class="red-bg"><span id="valor22">{{labviewData.[7]}}</span></td>
                    <td class="gray-bg"><span id="valor23">{{labviewData.[12]}}</span></td>
                </tr>
                <tr>
                    <td class="gray-bg"> </td>
                    <td class="gray-bg">Hora</td>
                    <td class="gray-bg">Turno</td>
                </tr>
            </table>
        </div>

        <div class="table-container">
            <table>
                <tr>
                    <th colspan="2">Linha: <span id="linhaSpan">{{labviewData.[3]}}</span></th>
                </tr>
                <tr>
                    <td colspan="2" class="destaque-cell">Hora X Hora</td>
                </tr>
                <tr>
                    <td class="destaque-cell">Hora</td>
                    <td class="destaque-cell">Produção</td>
                </tr>
                <tr><td>6:00</td><td><span id="valor24">{{labviewData.[24]}}</span></td></tr>
                <tr><td class="imparhora-cell">7:00</td><td class="imparhora-cell"><span id="valor25">{{labviewData.[25]}}</span></td></tr>
                <tr><td>8:00</td><td><span id="valor26">{{labviewData.[26]}}</span></td></tr>
                <tr><td class="imparhora-cell">9:00</td><td class="imparhora-cell"><span id="valor27">{{labviewData.[27]}}</span></td></tr>
                <tr><td>10:00</td><td><span id="valor28">{{labviewData.[28]}}</span></td></tr>
                <tr><td class="imparhora-cell">11:00</td><td class="imparhora-cell"><span id="valor29">{{labviewData.[29]}}</span></td></tr>
                <tr><td>12:00</td><td><span id="valor30">{{labviewData.[30]}}</span></td></tr>
                <tr><td class="imparhora-cell">13:00</td><td class="imparhora-cell"><span id="valor31">{{labviewData.[31]}}</span></td></tr>
                <tr><td>14:00</td><td><span id="valor32">{{labviewData.[32]}}</span></td></tr>
                <tr><td class="imparhora-cell">15:00</td><td class="imparhora-cell"><span id="valor33">{{labviewData.[33]}}</span></td></tr>
            </table>
        </div>
    </div>

    <script>
        let labviewData = {{json labviewData}};
        const errorMessageDiv = document.getElementById('errorMessage');

        function atualizarValores(data) {
            // Atualiza valores do sistema
            document.getElementById('systemName').textContent = data[0] || '';
            document.getElementById('periodoSpan').textContent = data[1] || '';
            document.getElementById('produtoSpan').textContent = data[2] || '';
            document.getElementById('linhaSpan').textContent = data[3] || '';

            // Atualiza valores da primeira tabela
            for (let i = 16; i <= 23; i++) {
                const elem = document.getElementById(`valor${i}`);
                if (elem) elem.textContent = data[i - 12] || '0';
            }

            // Atualiza valores da segunda tabela (hora x hora)
            for (let i = 24; i <= 33; i++) {
                const elem = document.getElementById(`valor${i}`);
                if (elem) elem.textContent = data[i] || '0';
            }
        }

        async function atualizarDadosLabVIEW() {
            try {
                const response = await fetch('/atualizar-dados');
                if (!response.ok) throw new Error('Erro na resposta do servidor');
                
                const data = await response.json();
                if (data.error) throw new Error(data.message || 'Erro ao atualizar dados');
                
                labviewData = data.labviewData;
                atualizarValores(labviewData);
                errorMessageDiv.style.display = 'none';
            } catch (error) {
                console.error('Erro ao atualizar dados:', error);
                errorMessageDiv.textContent = `Erro ao atualizar dados: ${error.message}`;
                errorMessageDiv.style.display = 'block';
            }
        }

        // Atualiza a cada 30 segundos
        setInterval(atualizarDadosLabVIEW, 30000);

        // Atualiza os valores ao carregar a página
        window.onload = function() {
            atualizarValores(labviewData);
        };
    </script>
</body>
</html>